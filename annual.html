<!doctype html>
<html lang="ko" data-theme="light">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ì—°ì°¨íœ´ê°€ ê³„ì‚°ê¸° (ì…ì‚¬ì¼ ê¸°ì¤€ Â· íšŒê³„ì—°ë„ ê¸°ì¤€)</title>
<meta name="description" content="ì…ì‚¬ì¼/í‡´ì‚¬ì¼ì„ ì…ë ¥í•˜ë©´ ì—°ì°¨íœ´ê°€ê°€ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤. (ì…ì‚¬ì¼ ê¸°ì¤€, íšŒê³„ì—°ë„ ê¸°ì¤€ ë™ì‹œ í‘œì‹œ)" />
<style>
  :root{
    --bg:#f6f8fb; --surface:#fff; --line:#e5eaf0;
    --text:#0d1b2a; --muted:#516173; --title:#0a0f18;
    --accent:#2a66ff; --ring:rgba(42,102,255,.22);
    --sec-bg:#0a2a60; --sec-fg:#fff; --yellow:#fff9e6;
  }
  [data-theme="dark"]{
    --bg:#0a0e13; --surface:#0f1520; --line:#1f2a3a;
    --text:#eef4fb; --muted:#8ea4b8; --title:#fff;
    --accent:#62a8ff; --ring:rgba(98,168,255,.35);
    --sec-bg:#0a2a60; --sec-fg:#fff; --yellow:#2a2412;
  }

  *{box-sizing:border-box; line-height:1.4}
  html,body{
    margin:0; padding:0; background:var(--bg); color:var(--text);
    font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,Helvetica,Arial,sans-serif
  }

  /* Top bar */
  .appbar{
    position:sticky; top:0; z-index:10;
    display:flex; justify-content:space-between; align-items:center; gap:12px;
    padding:12px 16px; background:var(--bg); border-bottom:1px solid var(--line);
    backdrop-filter:saturate(140%) blur(6px)
  }
  .brand a{display:inline-flex; align-items:center; gap:10px; font-weight:900; color:var(--title); text-decoration:none}
  .brand .logo{
    width:28px; height:28px; border-radius:8px;
    background:linear-gradient(135deg,#0a2a60 0%,#2a66ff 60%,#19a06a 100%);
    box-shadow:0 2px 8px rgba(0,0,0,.15)
  }
  .btn{
    border:1px solid var(--accent); border-radius:12px; padding:8px 12px;
    background:color-mix(in oklab,var(--accent) 12%, var(--surface));
    font-weight:700; cursor:pointer; white-space:nowrap
  }
  select{
    border:1px solid var(--line); border-radius:12px; padding:8px 12px;
    background:var(--surface); color:var(--text)
  }

  .container{max-width:1100px; margin:24px auto 80px; padding:0 16px}
  .sheet{
    background:var(--surface); border:1px solid var(--line); border-radius:18px;
    box-shadow:0 8px 30px rgba(0,0,0,.08); overflow:hidden
  }
  .sheet h1{
    margin:0; padding:18px; text-align:center; font-size:20px; font-weight:800; color:var(--title);
    border-bottom:1px solid var(--line); background:color-mix(in oklab, var(--surface) 92%, var(--bg))
  }

  /* Controls */
  .controls{
    display:flex; flex-wrap:wrap; align-items:center; gap:10px;
    padding:12px 16px; border-bottom:1px solid var(--line); background:var(--surface)
  }
  .controls input[type="text"]{
    border:1px solid var(--line); border-radius:12px; padding:8px 10px; background:var(--surface); color:var(--text);
    text-align:center; outline:none; transition:.15s; box-shadow:0 0 0 0 var(--ring)
  }
  .controls input:focus{border-color:var(--accent); box-shadow:0 0 0 6px var(--ring)}
  .subtle{font-size:12px; color:var(--muted)}

  /* Tables */
  .tables{display:grid; grid-template-columns:1fr 1fr; gap:16px; padding:16px}
  @media (max-width:900px){ .tables{grid-template-columns:1fr} }
  .table-wrap{border:1px solid var(--line); border-radius:14px; overflow:hidden; background:var(--surface)}

  table{
    width:100%; border-collapse:separate; border-spacing:0;
    table-layout:fixed;
  }
  td{
    border-bottom:1px solid var(--line); padding:10px 10px;
    white-space:nowrap; overflow:hidden; text-overflow:ellipsis; vertical-align:middle;
  }
  th{
    border-bottom:1px solid var(--line); padding:10px 10px;
    white-space:normal; overflow:hidden; vertical-align:middle;
    background:color-mix(in oklab,var(--surface) 90%, var(--bg)); font-weight:700; text-align:center
  }
  tr:last-child th, tr:last-child td{border-bottom:0}

  .sec-title{background:var(--sec-bg)!important; color:var(--sec-fg)!important; text-align:left; font-weight:800}
  .yellow{background:var(--yellow)}
  .right{text-align:right}
  .mono{font-variant-numeric:tabular-nums; font-family:Menlo,Consolas,monospace}

  .num-input{
    width:100%; text-align:right; padding:6px 8px;
    border:1px solid var(--line); border-radius:8px; background:var(--surface); color:var(--text);
  }
  .num-input:focus{outline:none; border-color:var(--accent); box-shadow:0 0 0 4px var(--ring)}

  .highlight-cell{
    background:#fffdf5;
    font-weight:800;
    border:0 !important;
    box-shadow: inset 0 0 0 2px #000;
    border-radius:12px;
  }

  .note{padding:16px; font-size:13px; color:var(--muted); border-top:1px solid var(--line); line-height:1.6}
  footer{max-width:1100px; margin:24px auto; padding:12px 16px; color:var(--muted); font-size:12px; line-height:1.6}
</style>
</head>
<body>

<!-- í—¤ë” -->
<div class="appbar">
  <div class="brand">
    <a href="./"><span class="logo"></span>LISANG&nbsp;Lab</a>
  </div>
  <div style="display:flex; gap:10px; align-items:center;">
    <label for="navSelect" class="subtle">ê³„ì‚°ê¸°</label>
    <select id="navSelect">
      <option value="./">ë©”ì¸</option>
      <option value="./severance.html">í‡´ì§ê¸ˆ ê³„ì‚°ê¸°</option>
      <option value="./annual.html" selected>ì—°ì°¨íœ´ê°€ ê³„ì‚°ê¸°</option>
      <option value="./hours52.html">ì£¼íœ´ì‹œê°„ ê³„ì‚°ê¸°</option>
      <option value="./parental.html">ì¶œì‚°Â·ìœ¡ì•„íœ´ì§ ê³„ì‚°ê¸°</option>
    </select>
    <button id="themeBtn" class="btn" type="button">ğŸŒ™ ë‹¤í¬ ëª¨ë“œ</button>
  </div>
</div>

<div class="container">
  <div class="sheet">
    <h1>ì—°ì°¨íœ´ê°€ ê³„ì‚°ê¸° (ì…ì‚¬ì¼ ê¸°ì¤€ Â· íšŒê³„ì—°ë„ ê¸°ì¤€)</h1>

    <!-- ì…ë ¥ -->
    <div class="controls">
      <label>ì…ì‚¬ì¼ <input id="joinDate" type="text" placeholder="yyyy-mm-dd"></label>
      <label>í‡´ì‚¬ì¼ <input id="leaveDate" type="text" placeholder="yyyy-mm-dd"></label>
      <button id="calcBtn" class="btn">ê³„ì‚°</button>
      <span class="subtle">ë‚ ì§œëŠ” 8ìë¦¬(ì˜ˆ: 20240712)ë§Œ ì…ë ¥í•´ë„ ë©ë‹ˆë‹¤.</span>
    </div>

    <div class="tables">
      <!-- íšŒê³„ì—°ë„ ê¸°ì¤€ -->
      <div class="table-wrap">
        <table id="tblFiscal">
          <colgroup>
            <col style="width:24%">
            <col style="width:26%">
            <col style="width:16%">
            <col style="width:17%">
            <col style="width:17%">
          </colgroup>
          <tr><th class="sec-title" colspan="5">ì—°ì°¨íœ´ê°€ (íšŒê³„ì—°ë„ ê¸°ì¤€)</th></tr>
          <tr>
            <th>êµ¬ë¶„</th>
            <th class="yellow">ë°œìƒì¼ì</th>
            <th class="yellow">ë°œìƒì¼ìˆ˜</th>
            <th>ê¸° ì‚¬ìš©ì¼ìˆ˜</th>
            <th>ë³´ìƒì¼ìˆ˜</th>
          </tr>
          <tbody id="fiscalBody"></tbody>
          <tr>
            <th>í•©ê³„</th>
            <td class="yellow"></td>
            <td class="yellow right mono highlight-cell" id="fiscalSum">0</td>
            <td class="right mono highlight-cell" id="fiscalUsedSum">0</td>
            <td class="right mono highlight-cell" id="fiscalCompSum">0</td>
          </tr>
        </table>
      </div>

      <!-- ì…ì‚¬ì¼ ê¸°ì¤€ -->
      <div class="table-wrap">
        <table id="tblAnniv">
          <colgroup>
            <col style="width:24%">
            <col style="width:26%">
            <col style="width:16%">
            <col style="width:17%">
            <col style="width:17%">
          </colgroup>
          <tr><th class="sec-title" colspan="5">ì—°ì°¨íœ´ê°€ (ì…ì‚¬ì¼ ê¸°ì¤€)</th></tr>
          <tr>
            <th>ê·¼ì†ë…„ìˆ˜</th>
            <th class="yellow">ë°œìƒì¼ì</th>
            <th class="yellow">ë°œìƒì¼ìˆ˜</th>
            <th>ê¸° ì‚¬ìš©ì¼ìˆ˜</th>
            <th>ë³´ìƒì¼ìˆ˜</th>
          </tr>
          <tbody id="annivBody"></tbody>
          <tr>
            <th>í•©ê³„</th>
            <td class="yellow"></td>
            <td class="yellow right mono highlight-cell" id="annivSum">0</td>
            <td class="right mono highlight-cell" id="annivUsedSum">0</td>
            <td class="right mono highlight-cell" id="annivCompSum">0</td>
          </tr>
        </table>
      </div>
    </div>

    <div class="note">
      * 2017ë…„ 5ì›” 29ì¼ ì´ì „ ì…ì‚¬ìì˜ ê²½ìš°ì—ë„ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.<br>
      * íšŒê³„ì—°ë„ ê¸°ì¤€ë³´ë‹¤ ì…ì‚¬ì¼ ê¸°ì¤€ìœ¼ë¡œ ë³´ìƒì¼ìˆ˜ê°€ ë§ìœ¼ë©´ ì…ì‚¬ì¼ ê¸°ì¤€ìœ¼ë¡œ ì •ì‚°í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.<br>
      * ìƒê¸° ê³„ì‚° ë°©ì‹ì€ ì—…ë¬´ì˜ í¸ì˜ë¥¼ ë•ê¸° ìœ„í•œ ê²ƒìœ¼ë¡œ ë²•ì  íš¨ë ¥ì´ ì—†ìœ¼ë©° êµ¬ì²´ì ì¸ ë‚´ìš©ì€ ê³µì¸ë…¸ë¬´ì‚¬ì— ë¬¸ì˜ ë°”ëë‹ˆë‹¤.
    </div>
  </div>
</div>

<footer>
  â“’ 2025 LISANG Lab. all rights reserved.<br>
  ë³¸ ì‚¬ì´íŠ¸ì˜ ì½˜í…ì¸ (ë¬¸ì„œ, ì½”ë“œ, ë””ìì¸, ê³„ì‚° ë¡œì§ ë“±)ëŠ” ë¹„ì˜ë¦¬ì  ëª©ì ì˜ ê³µìœ Â·ì¸ìš©Â·ë°°í¬ëŠ” ì¶œì²˜(â€˜LISANG Labâ€™)ë¥¼ ëª…ì‹œí•˜ë©´ ììœ ë¡­ê²Œ í—ˆìš©í•©ë‹ˆë‹¤.<br>
  ë‹¨, ë™ì˜ì—†ëŠ” ìƒì—…ì  ì´ìš©(ì˜ë¦¬ ëª©ì ì˜ ë³µì œÂ·ë°°í¬Â·íŒë§¤Â·ì¬ê°€ê³µ ë“±)ì€ ê¸ˆì§€ë©ë‹ˆë‹¤.<br>
  ì´ìš© ì¤‘ ì˜¤ë¥˜ ì œë³´ë‚˜ ê°œì„  ì œì•ˆì€ <a href="mailto:lisang.hr.lab@gmail.com">lisang.hr.lab@gmail.com</a> ìœ¼ë¡œ ì—°ë½í•´ ì£¼ì„¸ìš”.
</footer>

<script>
/* ===== ë„¤ë¹„ê²Œì´ì…˜ ===== */
document.getElementById('navSelect').addEventListener('change', e=>{
  if(e.target.value) location.href = e.target.value;
});

/* ===== Theme toggle ===== */
(function(){
  const saved = localStorage.getItem('theme');
  if(saved) document.documentElement.setAttribute('data-theme', saved);
  updateThemeBtn();
})();
function updateThemeBtn(){
  const dark = document.documentElement.getAttribute('data-theme')==='dark';
  document.getElementById('themeBtn').textContent = dark ? 'â˜€ï¸ ë¼ì´íŠ¸ ëª¨ë“œ' : 'ğŸŒ™ ë‹¤í¬ ëª¨ë“œ';
}
document.getElementById('themeBtn').addEventListener('click', ()=>{
  const cur = document.documentElement.getAttribute('data-theme') || 'light';
  const next = cur==='light' ? 'dark' : 'light';
  document.documentElement.setAttribute('data-theme', next);
  localStorage.setItem('theme', next);
  updateThemeBtn();
});

/* ===== Date helper ===== */
function toYmd(val){
  const v=(val||'').replace(/\D/g,''); if(v.length!==8) return null;
  const y=v.slice(0,4), m=v.slice(4,6), d=v.slice(6,8);
  const mm=+m, dd=+d; if(mm<1||mm>12||dd<1||dd>31) return null;
  return `${y}-${m}-${d}`;
}
['joinDate','leaveDate'].forEach(id=>{
  const el=document.getElementById(id);
  el.addEventListener('input', ()=>{ const fm=toYmd(el.value); if(fm) el.value=fm; });
});

/* ===== Helpers ===== */
const dt = s => new Date(s);
const fmtDate = d => d.toISOString().slice(0,10);
function addMonths(date,n){
  const d=new Date(date); const day=d.getDate();
  d.setMonth(d.getMonth()+n);
  if(d.getDate()<day){ d.setDate(0); }
  return d;
}
function addYears(date,n){ const d=new Date(date); d.setFullYear(d.getFullYear()+n); return d; }
function daysInclusive(a,b){ const A=(a instanceof Date)?a:new Date(a); const B=(b instanceof Date)?b:new Date(b); return Math.max(0, Math.floor((B-A)/86400000)+1); }

/* ===== Business Logic ===== */
function monthlyAccruals(join, leave){
  const firstAnniv = addYears(join,1);
  const end = (leave && leave<firstAnniv) ? leave : firstAnniv;
  const arr=[]; let cur=addMonths(join,1);
  while(cur<=end){ arr.push(new Date(cur)); cur=addMonths(cur,1); }
  return arr.filter(d => d < firstAnniv && (!leave || d<=leave));
}
function regularDaysByYearN(n){ return Math.min(25, 15 + Math.floor((n-1)/2)); }
/* íšŒê³„ì—°ë„: 3Â·4ë…„ì°¨=15, 5ë…„ì°¨ë¶€í„° ê°€ì‚° */
function fiscalDaysByDisplayYear(y){
  if(y<=4) return 15;
  const add=Math.floor((y-3)/2);
  return Math.min(25, 15 + add);
}

function clearTbody(tb){ while(tb.firstChild) tb.removeChild(tb.firstChild); }
function tr(cells){ const r=document.createElement('tr'); cells.forEach(c=>r.appendChild(c)); return r; }
function th(text){ const e=document.createElement('th'); e.textContent=text; return e; }
function td(text, cls=''){ const e=document.createElement('td'); e.textContent=text; if(cls) e.className=cls; return e; }

function usedCompCells(baseDays, typeTag, isLegacy){
  const usedTd=document.createElement('td');
  const inp=document.createElement('input');
  inp.type='number'; inp.min='0'; inp.step='0.1'; inp.value='0'; inp.className='num-input mono right';
  usedTd.appendChild(inp);
  const compTd=document.createElement('td'); compTd.className='right mono';
  function update(){
    let comp=0;
    if(isLegacy && (typeTag==='fiscal-y1' || typeTag==='fiscal-y2carry' || typeTag==='anniv-under1')){
      comp = 0;
    }else{
      const used=parseFloat(inp.value)||0;
      comp = Math.max(0, baseDays - used);
    }
    compTd.textContent = comp.toFixed(1);
    recalcSums();
  }
  inp.addEventListener('input', update);
  update();
  return [usedTd, compTd];
}

function recalcSums(){
  [['fiscalBody','fiscalSum','fiscalUsedSum','fiscalCompSum'],
   ['annivBody','annivSum','annivUsedSum','annivCompSum']].forEach(([tbodyId,sumId,usedId,compId])=>{
    const tbody=document.getElementById(tbodyId);
    const base=[...tbody.querySelectorAll('td.yellow.right')].reduce((a,e)=>a+(parseFloat(e.textContent)||0),0);
    const used=[...tbody.querySelectorAll('input.num-input')].reduce((a,e)=>a+(parseFloat(e.value)||0),0);
    const comp=[...tbody.querySelectorAll('tr')].reduce((a,row)=>{
      const last=row.querySelector('td:last-child'); return a+(last?(parseFloat(last.textContent)||0):0);
    },0);
    document.getElementById(sumId).textContent = base.toFixed(1);
    document.getElementById(usedId).textContent = used.toFixed(1);
    document.getElementById(compId).textContent = comp.toFixed(1);
  });
}

function calc(){
  const jStr=document.getElementById('joinDate').value;
  const lStr=document.getElementById('leaveDate').value;
  if(!jStr) return;
  const join=dt(jStr);
  const leave=lStr?dt(lStr):null;

  const isLegacy = join < new Date('2017-05-29');

  /* ì…ì‚¬ì¼ ê¸°ì¤€ */
  const aBody=document.getElementById('annivBody'); clearTbody(aBody);
  let aSum=0;

  const mDates=monthlyAccruals(join, leave);
  if(mDates.length){
    const label=`ë§¤ì›” ${String(join.getDate()).padStart(2,'0')}ì¼`;
    const base=mDates.length*1.0;
    const [u,c]=usedCompCells(base,'anniv-under1',isLegacy);
    aBody.appendChild(tr([ th('1ë…„ ë¯¸ë§Œ'), td(label,'yellow'), td(base.toFixed(1),'yellow right mono'), u, c ]));
    aSum += base;
  }

  let n=1, genDate=addYears(join,1);
  while(!leave || genDate<=leave){
    const days=regularDaysByYearN(n);
    const base=days*1.0;
    const [u,c]=usedCompCells(base,'anniv-regular',isLegacy);
    aBody.appendChild(tr([ th(`${n}ë…„ê·¼ì†`), td(fmtDate(genDate),'yellow'), td(base.toFixed(1),'yellow right mono'), u, c ]));
    aSum += base;
    n++; genDate=addYears(genDate,1);
    if(n>50) break;
  }
  document.getElementById('annivSum').textContent = aSum.toFixed(1);

  /* íšŒê³„ì—°ë„ ê¸°ì¤€ */
  const fBody=document.getElementById('fiscalBody'); clearTbody(fBody);
  let fSum=0;

  const firstAnniv=addYears(join,1);
  const monthsAll=monthlyAccruals(join, leave);
  const monthsY1=monthsAll.filter(d=>d.getFullYear()===join.getFullYear());
  const monthsCarry=monthsAll.filter(d=>d.getFullYear()!==join.getFullYear());
  const monthLabel=`ë§¤ì›” ${String(join.getDate()).padStart(2,'0')}ì¼`;

  // 1ë…„ì°¨
  {
    const base=monthsY1.length*1.0;
    const [u,c]=usedCompCells(base,'fiscal-y1',isLegacy);
    fBody.appendChild(tr([ th('1ë…„ì°¨'), td(monthLabel,'yellow'), td(base.toFixed(1),'yellow right mono'), u, c ]));
    fSum += base;
  }
  // 2ë…„ì°¨ @
  {
    const base=monthsCarry.length*1.0;
    const [u,c]=usedCompCells(base,'fiscal-y2carry',isLegacy);
    fBody.appendChild(tr([ th('2ë…„ì°¨ @'), td(monthLabel,'yellow'), td(base.toFixed(1),'yellow right mono'), u, c ]));
    fSum += base;
  }
  // 2ë…„ì°¨(ë¹„ë¡€ì—°ì°¨) - 1/1ì´ í‡´ì‚¬ í›„ë©´ ìƒëµ
  {
    const rowDate = new Date(firstAnniv.getFullYear(), 0, 1);
    if(!leave || rowDate <= leave){
      const endPrevYear=new Date(join.getFullYear(),11,31);
      let prorate=0;
      if(endPrevYear>=join){
        const svcPrev=daysInclusive(join,endPrevYear);
        prorate = Math.ceil(((svcPrev/365)*15)*10)/10;
      }
      const base=prorate*1.0;
      const [u,c]=usedCompCells(base,'fiscal-y2prorate',isLegacy);
      fBody.appendChild(tr([ th('2ë…„ì°¨(ë¹„ë¡€ì—°ì°¨)'), td(fmtDate(rowDate),'yellow'), td(base.toFixed(1),'yellow right mono'), u, c ]));
      fSum += base;
    }
  }
  // 3ë…„ì°¨ ì´í›„ â€” í‡´ì‚¬ì—°ë„ 12/31 ê¸°ì¤€ìœ¼ë¡œ ë¹„êµ
  {
// 3ë…„ì°¨ ì´í›„ â€” ê° í•´ 1/1ì´ í‡´ì‚¬ì¼ ì´ì „ì¼ ë•Œë§Œ ì¶œë ¥ (â† ì´ê²Œ ì›ë˜ ì˜ë„)
{
  let displayYear = 3;                         // 3ë…„ì°¨ë¶€í„°
  let year = firstAnniv.getFullYear() + 1;     // 3ë…„ì°¨ê°€ ë˜ëŠ” í•´ (ì˜ˆ: 2025)

  while (true) {
    const rowDate = new Date(year, 0, 1);      // â˜… ë§¤ë…„ 1ì›” 1ì¼ ë°œìƒ

    // í‡´ì‚¬ì¼ì´ ìˆê³ , ê·¸ í‡´ì‚¬ì¼ë³´ë‹¤ ì´ 1/1ì´ ëŠ¦ìœ¼ë©´ ê·¸ í•´ë¶€í„°ëŠ” ì•ˆ ë³´ì—¬ì¤Œ
    if (leave && rowDate > leave) break;

    const days = fiscalDaysByDisplayYear(displayYear);
    const base = days * 1.0;
    const [u, c] = usedCompCells(base, 'fiscal-regular', isLegacy);

    fBody.appendChild(tr([
      th(`${displayYear}ë…„ì°¨`),
      td(fmtDate(rowDate), 'yellow'),
      td(base.toFixed(1), 'yellow right mono'),
      u,
      c
    ]));

    fSum += base;
    displayYear++;
    year++;
    if (displayYear > 50) break;
  }
}

      const days = fiscalDaysByDisplayYear(displayYear);
      const base = days * 1.0;
      const [u,c]=usedCompCells(base,'fiscal-regular',isLegacy);
      fBody.appendChild(tr([ th(`${displayYear}ë…„ì°¨`), td(fmtDate(rowDate),'yellow'), td(base.toFixed(1),'yellow right mono'), u, c ]));
      fSum += base;

      displayYear++;
      year++;
      if(displayYear > 50) break;
    }
  }

  document.getElementById('fiscalSum').textContent = fSum.toFixed(1);

  recalcSums();
}

document.getElementById('calcBtn').addEventListener('click', calc);
</script>
</body>
</html>
