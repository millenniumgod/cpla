<!doctype html>
<html lang="ko" data-theme="light">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>연차휴가 계산기 (입사일 기준 · 회계연도 기준)</title>
<meta name="description" content="입사일/퇴사일을 입력하면 연차휴가가 자동 계산됩니다. (입사일 기준, 회계연도 기준 동시 표시)" />
<style>
  :root{
    --bg:#f6f8fb; --surface:#fff; --line:#e5eaf0; --text:#0d1b2a; --muted:#516173;
    --title:#0a0f18; --accent:#2a66ff; --ring:rgba(42,102,255,.22);
    --sec-bg:#0a2a60; --sec-fg:#fff; --yellow:#fff9e6;
  }
  [data-theme="dark"]{
    --bg:#0a0e13; --surface:#0f1520; --line:#1f2a3a; --text:#eef4fb; --muted:#8ea4b8;
    --title:#fff; --accent:#62a8ff; --ring:rgba(98,168,255,.35);
    --sec-bg:#0a2a60; --sec-fg:#fff; --yellow:#2a2412;
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--text);
    font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,Helvetica,Arial,sans-serif}
  .appbar{position:sticky;top:0;z-index:10;display:flex;gap:12px;align-items:center;justify-content:space-between;
    padding:12px 16px;background:var(--bg);border-bottom:1px solid var(--line);backdrop-filter:saturate(140%) blur(6px)}
  .brand{font-weight:800;color:var(--title)}
  .container{max-width:1100px;margin:24px auto 80px;padding:0 16px}
  .sheet{background:var(--surface);border:1px solid var(--line);border-radius:18px;overflow:hidden;
    box-shadow:0 8px 30px rgba(0,0,0,.08)}
  .sheet h1{margin:0;padding:18px;text-align:center;font-size:20px;font-weight:800;color:var(--title);
    border-bottom:1px solid var(--line);background:color-mix(in oklab, var(--surface) 92%, var(--bg))}
  .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;padding:12px 16px;border-bottom:1px solid var(--line);background:var(--surface)}
  .controls input[type="text"]{border:1px solid var(--line);border-radius:12px;padding:10px 12px;background:var(--surface);color:var(--text);
    outline:none;transition:.15s;box-shadow:0 0 0 0 var(--ring)}
  .controls input::placeholder{color:#9aa6b2}
  .controls input:focus{border-color:var(--accent);box-shadow:0 0 0 6px var(--ring)}
  .btn{border:1px solid var(--accent);border-radius:12px;padding:10px 12px;background:color-mix(in oklab, var(--accent) 12%, var(--surface));
    font-weight:700;cursor:pointer}
  .tables{display:grid;grid-template-columns:1fr 1fr;gap:16px;padding:16px}
  @media (max-width: 900px){ .tables{grid-template-columns:1fr} }
  .table-wrap{border:1px solid var(--line);border-radius:14px;overflow:hidden;background:var(--surface)}
  table{width:100%;border-collapse:separate;border-spacing:0}
  th,td{border-bottom:1px solid var(--line);padding:10px 10px;vertical-align:middle}
  th{background:color-mix(in oklab, var(--surface) 90%, var(--bg));font-weight:700}
  tr:last-child th, tr:last-child td{border-bottom:0}
  .sec-title{background:var(--sec-bg)!important;color:var(--sec-fg)!important;text-align:left;font-weight:800}
  .right{text-align:right}
  .mono{font-variant-numeric:tabular-nums}
  .yellow{background:var(--yellow)}
  .num-input{width:100%; text-align:right; padding:6px 8px; border:1px solid var(--line); border-radius:8px; background:var(--surface); color:var(--text);}
  .num-input:focus{outline:none; border-color:var(--accent); box-shadow:0 0 0 4px var(--ring)}
  .note{padding:16px; font-size:13px; color:var(--muted); border-top:1px solid var(--line); line-height:1.6;}
</style>
</head>
<body>
  <div class="appbar">
    <div class="brand">연차휴가 계산기</div>
    <div><button id="themeBtn" class="btn" type="button">🌙 다크 모드</button></div>
  </div>

  <div class="container">
    <div class="sheet">
      <h1>연차휴가 계산기 (입사일 기준 · 회계연도 기준)</h1>

      <div class="controls">
        <label>입사일 <input id="joinDate" type="text" placeholder="yyyy-mm-dd"></label>
        <label>퇴사일 <input id="leaveDate" type="text" placeholder="yyyy-mm-dd"></label>
        <button id="calcBtn" class="btn">계산</button>
        <span class="subtle">날짜는 8자리(예: 20240712)만 입력해도 됩니다.</span>
      </div>

      <div class="tables">
        <!-- 회계연도 기준 -->
        <div class="table-wrap">
          <table id="tblFiscal">
            <tr><th class="sec-title" colspan="5">연차휴가 계산기 (회계연도 기준)</th></tr>
            <tr>
              <th style="width:20%">구분</th>
              <th class="yellow">발생일자</th>
              <th class="yellow right">발생일수</th>
              <th>기 사용일수</th>
              <th>보상일수</th>
            </tr>
            <tbody id="fiscalBody"></tbody>
            <tr>
              <th>합계</th>
              <td class="yellow"></td>
              <td class="yellow right mono" id="fiscalSum">0</td>
              <td class="right mono" id="fiscalUsedSum">0</td>
              <td class="right mono" id="fiscalCompSum">0</td>
            </tr>
          </table>
        </div>

        <!-- 입사일 기준 -->
        <div class="table-wrap">
          <table id="tblAnniv">
            <tr><th class="sec-title" colspan="5">연차휴가 계산기 (입사일 기준)</th></tr>
            <tr>
              <th style="width:20%">근속년수</th>
              <th class="yellow">발생일자</th>
              <th class="yellow right">발생일수</th>
              <th>기 사용일수</th>
              <th>보상일수</th>
            </tr>
            <tbody id="annivBody"></tbody>
            <tr>
              <th>합계</th>
              <td class="yellow"></td>
              <td class="yellow right mono" id="annivSum">0</td>
              <td class="right mono" id="annivUsedSum">0</td>
              <td class="right mono" id="annivCompSum">0</td>
            </tr>
          </table>
        </div>
      </div>

      <!-- ✅ 안내 문구 추가 -->
      <div class="note">
        * 2017년 5월 29일 이전 입사자의 경우에도 자동 계산됩니다.<br>
        * 상기 계산 방식은 업무의 편의를 돕기 위한 것으로 법적 효력이 없으며 구체적인 내용은 공인노무사에 문의 바랍니다.
      </div>
    </div>
  </div>

<script>
/* ===== Theme toggle ===== */
(function(){
  const saved = localStorage.getItem('theme'); if(saved) document.documentElement.setAttribute('data-theme', saved);
  updateThemeBtn();
})();
function updateThemeBtn(){
  const dark = document.documentElement.getAttribute('data-theme')==='dark';
  document.getElementById('themeBtn').textContent = dark ? '☀️ 라이트 모드' : '🌙 다크 모드';
}
document.getElementById('themeBtn').addEventListener('click', ()=>{
  const cur = document.documentElement.getAttribute('data-theme') || 'light';
  const next = cur==='light' ? 'dark' : 'light';
  document.documentElement.setAttribute('data-theme', next);
  localStorage.setItem('theme', next);
  updateThemeBtn();
});

/* ===== Date input helper ===== */
function toYmd(val){
  const v=(val||'').replace(/\D/g,''); if(v.length!==8) return null;
  const y=v.slice(0,4), m=v.slice(4,6), d=v.slice(6,8);
  const mm=+m, dd=+d; if(mm<1||mm>12||dd<1||dd>31) return null;
  return `${y}-${m}-${d}`;
}
['joinDate','leaveDate'].forEach(id=>{
  const el=document.getElementById(id);
  el.addEventListener('input', ()=>{ const fm=toYmd(el.value); if(fm) el.value=fm; });
});

/* ===== Helpers ===== */
const dt = s => new Date(s);
const fmtDate = d => d.toISOString().slice(0,10);
function addMonths(date, n){
  const d=new Date(date); const day=d.getDate();
  d.setMonth(d.getMonth()+n);
  if(d.getDate()<day){ d.setDate(0); }
  return d;
}
function addYears(date, n){ const d=new Date(date); d.setFullYear(d.getFullYear()+n); return d; }
function daysInclusive(a,b){ const A=(a instanceof Date)?a:new Date(a); const B=(b instanceof Date)?b:new Date(b); return Math.max(0, Math.floor((B-A)/86400000)+1); }

/* ===== Logic ===== */
// 1년 미만 월차
function monthlyAccruals(join, leave){
  const firstAnniv = addYears(join,1);
  const end = (leave && leave<firstAnniv) ? leave : firstAnniv;
  const arr=[]; let cur=addMonths(join,1);
  while(cur<=end){ arr.push(new Date(cur)); cur=addMonths(cur,1); }
  return arr.filter(d => d < firstAnniv && (!leave || d<=leave));
}
// 정기연차: n=1→15(2년차), n=2→15(3년차), n=3→16(4~5년차)… 상한 25
function regularDaysByYearN(n){ return Math.min(25, 15 + Math.floor((n-1)/2)); }

function clearTbody(tb){ while(tb.firstChild) tb.removeChild(tb.firstChild); }
function tr(cells){ const r=document.createElement('tr'); cells.forEach(c=>r.appendChild(c)); return r; }
function th(t){ const e=document.createElement('th'); e.textContent=t; return e; }
function td(t,cls=''){ const e=document.createElement('td'); e.textContent=t; if(cls) e.className=cls; return e; }

/* 사용/보상 셀 (자동 특례 반영) */
function usedCompCells(baseDays, typeTag, isLegacy){
  const usedTd=document.createElement('td');
  const inp=document.createElement('input');
  inp.type='number'; inp.min='0'; inp.step='0.1'; inp.value='0'; inp.className='num-input mono';
  usedTd.appendChild(inp);

  const compTd=document.createElement('td'); compTd.className='right mono';
  function update(){
    let comp=0;
    // 특례: 2017-05-29 이전 입사자는 지정 구간 보상일수 0 처리
    if(isLegacy && (typeTag==='fiscal-y1' || typeTag==='fiscal-y2carry' || typeTag==='anniv-under1')){
      comp = 0;
    }else{
      const used=parseFloat(inp.value)||0;
      comp = Math.max(0, baseDays - used);
    }
    compTd.textContent=(Math.round(comp*10)/10).toString();
    recalcSums();
  }
  inp.addEventListener('input', update);
  update(); // 초기값 반영
  return [usedTd, compTd];
}

/* 합계 집계 */
function recalcSums(){
  [['fiscalBody','fiscalSum','fiscalUsedSum','fiscalCompSum'],
   ['annivBody','annivSum','annivUsedSum','annivCompSum']].forEach(([tbodyId,sumId,usedId,compId])=>{
    const tbody=document.getElementById(tbodyId);
    const base=[...tbody.querySelectorAll('td.yellow.right')].reduce((a,e)=>a+(parseFloat(e.textContent)||0),0);
    const used=[...tbody.querySelectorAll('input.num-input')].reduce((a,e)=>a+(parseFloat(e.value)||0),0);
    const comp=[...tbody.querySelectorAll('tr')].reduce((a,row)=>{
      const last=row.querySelector('td:last-child'); return a+(last?(parseFloat(last.textContent)||0):0);
    },0);
    document.getElementById(sumId).textContent=(Math.round(base*10)/10).toString();
    document.getElementById(usedId).textContent=(Math.round(used*10)/10).toString();
    document.getElementById(compId).textContent=(Math.round(comp*10)/10).toString();
  });
}

/* ===== Main calc ===== */
function calc(){
  const jStr=document.getElementById('joinDate').value;
  const lStr=document.getElementById('leaveDate').value;
  if(!jStr) return;
  const join=dt(jStr), leave=lStr?dt(lStr):null;

  // 자동 특례 판정
  const isLegacy = join < new Date('2017-05-29');

  /* ---- 입사일 기준 ---- */
  const aBody=document.getElementById('annivBody'); clearTbody(aBody);
  let annivBaseSum=0;

  // 1년 미만
  const mDates=monthlyAccruals(join, leave);
  if(mDates.length){
    const label=`매월 ${String(join.getDate()).padStart(2,'0')}일`;
    const base=mDates.length*1.0;
    const [u,c]=usedCompCells(base,'anniv-under1',isLegacy);
    aBody.appendChild(tr([th('1년 미만'), td(label,'yellow'), td(base.toFixed(1),'yellow right mono'), u, c]));
    annivBaseSum += base;
  }

  // 만1년 이후 정기연차
  let n=1; let genDate=addYears(join,1);
  while(!leave || genDate<=leave){
    const days=regularDaysByYearN(n); const base=+days.toFixed(1);
    const [u,c]=usedCompCells(base,'anniv-regular',isLegacy);
    aBody.appendChild(tr([th(`${n}년근속`), td(fmtDate(genDate),'yellow'), td(base.toFixed(1),'yellow right mono'), u, c]));
    annivBaseSum += base;
    n++; genDate=addYears(genDate,1); if(n>50) break;
  }
  document.getElementById('annivSum').textContent=(Math.round(annivBaseSum*10)/10).toString();

  /* ---- 회계연도 기준 ---- */
  const fBody=document.getElementById('fiscalBody'); clearTbody(fBody);
  let fiscalBaseSum=0;

  const firstAnniv=addYears(join,1);
  const monthsAll=monthlyAccruals(join, leave);
  const monthsY1=monthsAll.filter(d=>d.getFullYear()===join.getFullYear());
  const monthsCarry=monthsAll.filter(d=>d.getFullYear()!==join.getFullYear());
  const monthLabel=`매월 ${String(join.getDate()).padStart(2,'0')}일`;

  // 1년차(입사연도 내 월차)
  {
    const base=monthsY1.length*1.0;
    const [u,c]=usedCompCells(base,'fiscal-y1',isLegacy);
    fBody.appendChild(tr([th('1년차'), td(monthLabel,'yellow'), td(base.toFixed(1),'yellow right mono'), u, c]));
    fiscalBaseSum += base;
  }
  // 2년차 @ (carry)
  {
    const base=monthsCarry.length*1.0;
    const [u,c]=usedCompCells(base,'fiscal-y2carry',isLegacy);
    fBody.appendChild(tr([th('2년차 @'), td(monthLabel,'yellow'), td(base.toFixed(1),'yellow right mono'), u, c]));
    fiscalBaseSum += base;
  }
  // 2년차(비례연차)
  {
    const endPrevYear=new Date(join.getFullYear(),11,31); // 입사연도 12/31
    let prorate=0;
    if(endPrevYear>=join){
      const svcPrev=daysInclusive(join, endPrevYear);
      const raw=(svcPrev/365)*15;
      prorate=Math.ceil(raw*10)/10; // 둘째자리 올림 → 1자리 표시
    }
    const base=+prorate.toFixed(1);
    const [u,c]=usedCompCells(base,'fiscal-y2prorate',isLegacy);
    fBody.appendChild(tr([th('2년차(비례연차)'), td(`${firstAnniv.getFullYear()}-01-01`,'yellow'), td(base.toFixed(1),'yellow right mono'), u, c]));
    fiscalBaseSum += base;
  }
  // 3년차부터 온전히 발생(해마다 1/1)
  {
    let fyYear = firstAnniv.getFullYear()+1; // 3년차 해
    let fyN = 2;                             // 정기연차 N: 1=2년차(위 처리), 2=3년차 …
    let fyDate = addYears(firstAnniv,1);     // 만2년 도달일(3년차 시작 기준)
    while(!leave || fyDate <= leave){
      const days = regularDaysByYearN(fyN);
      const base = +days.toFixed(1);
      const [u,c]=usedCompCells(base,'fiscal-regular',isLegacy);
      fBody.appendChild(tr([th(`${fyN+1}년차`), td(`${fyYear}-01-01`,'yellow'), td(base.toFixed(1),'yellow right mono'), u, c]));
      fiscalBaseSum += base;
      fyN++; fyYear++; fyDate = addYears(fyDate,1);
      if(fyN>50) break; // 안전장치
    }
  }
  document.getElementById('fiscalSum').textContent=(Math.round(fiscalBaseSum*10)/10).toString();

  // 합계 갱신
  recalcSums();
}

document.getElementById('calcBtn').addEventListener('click', calc);
</script>
</body>
</html>
