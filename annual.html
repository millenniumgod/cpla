<!doctype html>
<html lang="ko" data-theme="light">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>ì—°ì°¨íœ´ê°€ ê³„ì‚°ê¸° (ì…ì‚¬ì¼ ê¸°ì¤€ Â· íšŒê³„ì—°ë„ ê¸°ì¤€)</title>
<meta name="description" content="ì…ì‚¬ì¼/í‡´ì‚¬ì¼ì„ ì…ë ¥í•˜ë©´ ì—°ì°¨íœ´ê°€ê°€ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤. (ì…ì‚¬ì¼ ê¸°ì¤€, íšŒê³„ì—°ë„ ê¸°ì¤€ ë™ì‹œ í‘œì‹œ)" />
<style>
  :root{
    --bg:#f6f8fb; --surface:#fff; --line:#e5eaf0; --text:#0d1b2a; --muted:#516173;
    --title:#0a0f18; --accent:#2a66ff; --ring:rgba(42,102,255,.22);
    --sec-bg:#0a2a60; --sec-fg:#fff; --yellow:#fff9e6;
  }
  [data-theme="dark"]{
    --bg:#0a0e13; --surface:#0f1520; --line:#1f2a3a; --text:#eef4fb; --muted:#8ea4b8;
    --title:#fff; --accent:#62a8ff; --ring:rgba(98,168,255,.35);
    --sec-bg:#0a2a60; --sec-fg:#fff; --yellow:#2a2412;
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--text);
    font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,Helvetica,Arial,sans-serif}

  /* ===== App bar: ë¸Œëœë“œ(ë¡œê³ ) í´ë¦­ â†’ í™ˆ ===== */
  .appbar{position:sticky;top:0;z-index:10;display:flex;gap:12px;align-items:center;justify-content:space-between;
    padding:12px 16px;background:var(--bg);border-bottom:1px solid var(--line);backdrop-filter:saturate(140%) blur(6px)}
  .brand a{display:inline-flex;align-items:center;gap:10px;
    font-weight:900;color:var(--title);text-decoration:none;letter-spacing:.2px}
  .brand .logo{
    width:28px;height:28px;border-radius:8px;display:inline-block;
    background:linear-gradient(135deg,#0a2a60 0%, #2a66ff 60%, #19a06a 100%);
    box-shadow:0 2px 8px rgba(0,0,0,.15)
  }
  select,.btn{border:1px solid var(--line);border-radius:12px;padding:10px 12px;background:var(--surface);color:var(--text);outline:none;transition:.15s}
  select:hover{border-color:color-mix(in oklab, var(--accent) 30%, var(--line))}
  .btn{border:1px solid var(--accent);background:color-mix(in oklab, var(--accent) 12%, var(--surface));font-weight:700;cursor:pointer}

  .container{max-width:1100px;margin:24px auto 80px;padding:0 16px}
  .sheet{background:var(--surface);border:1px solid var(--line);border-radius:18px;overflow:hidden;box-shadow:0 8px 30px rgba(0,0,0,.08)}
  .sheet h1{margin:0;padding:18px;text-align:center;font-size:20px;font-weight:800;color:var(--title);
    border-bottom:1px solid var(--line);background:color-mix(in oklab, var(--surface) 92%, var(--bg))}
  .controls{display:flex;gap:10px;flex-wrap:wrap;align-items:center;padding:12px 16px;border-bottom:1px solid var(--line);background:var(--surface)}
  .controls input[type="text"]{border:1px solid var(--line);border-radius:12px;padding:10px 12px;background:var(--surface);color:var(--text);
    outline:none;transition:.15s;box-shadow:0 0 0 0 var(--ring)}
  .controls input::placeholder{color:#9aa6b2}
  .controls input:focus{border-color:var(--accent);box-shadow:0 0 0 6px var(--ring)}

  .tables{display:grid;grid-template-columns:1fr 1fr;gap:16px;padding:16px}
  @media (max-width:900px){.tables{grid-template-columns:1fr}}
  .table-wrap{border:1px solid var(--line);border-radius:14px;overflow:hidden;background:var(--surface)}
  table{width:100%;border-collapse:separate;border-spacing:0}
  th,td{border-bottom:1px solid var(--line);padding:10px 10px;vertical-align:middle}
  th{background:color-mix(in oklab, var(--surface) 90%, var(--bg));font-weight:700}
  tr:last-child th,tr:last-child td{border-bottom:0}
  .sec-title{background:var(--sec-bg)!important;color:var(--sec-fg)!important;text-align:left;font-weight:800}
  .right{text-align:right}
  .mono{font-variant-numeric:tabular-nums}
  .yellow{background:var(--yellow)}
  .num-input{width:100%;text-align:right;padding:6px 8px;border:1px solid var(--line);border-radius:8px;background:var(--surface);color:var(--text)}
  .num-input:focus{outline:none;border-color:var(--accent);box-shadow:0 0 0 4px var(--ring)}
  .note{padding:16px;font-size:13px;color:var(--muted);border-top:1px solid var(--line);line-height:1.6}

  /* í•©ê³„ ê°•ì¡° */
  .highlight-cell{background:#fffdf7;border:2px inset #000;border-radius:12px;font-weight:700}

  /* ===== Footer(ê³µí†µ ê³ ì§€) ===== */
  footer.site-footer{
    margin:28px auto 40px; max-width:1100px; padding:16px;
    color:var(--muted); font-size:12.5px; line-height:1.7;
  }
  footer.site-footer .brand-inline{
    font-weight:900; color:var(--title);
  }
</style>
</head>
<body>

<!-- App bar: ë¡œê³  í´ë¦­í•˜ë©´ ë©”ì¸(index.html)ìœ¼ë¡œ ì´ë™ -->
<div class="appbar">
  <div class="brand">
    <a href="./" aria-label="LISANG Lab í™ˆìœ¼ë¡œ">
      <span class="logo" aria-hidden="true"></span>
      LISANG&nbsp;Lab
    </a>
  </div>
  <div style="display:flex;gap:10px;align-items:center;">
    <label for="navSelect" class="subtle" style="font-size:12px;color:var(--muted);">ê³„ì‚°ê¸°</label>
    <select id="navSelect">
      <option value="./">ë©”ì¸</option>
      <option value="./severance.html">í‡´ì§ê¸ˆ ê³„ì‚°ê¸°</option>
      <option value="./annual.html" selected>ì—°ì°¨íœ´ê°€ ê³„ì‚°ê¸°</option>
      <option value="./hours52.html">ì£¼íœ´ì‹œê°„ ê³„ì‚°ê¸°</option>
      <option value="./parental.html">ì¶œì‚°Â·ìœ¡ì•„íœ´ì§ ê³„ì‚°ê¸°</option>
    </select>
    <button id="themeBtn" class="btn" type="button">ğŸŒ™ ë‹¤í¬ ëª¨ë“œ</button>
  </div>
</div>

<div class="container">
  <div class="sheet">
    <h1>ì—°ì°¨íœ´ê°€ ê³„ì‚°ê¸° (ì…ì‚¬ì¼ ê¸°ì¤€ Â· íšŒê³„ì—°ë„ ê¸°ì¤€)</h1>

    <div class="controls">
      <label>ì…ì‚¬ì¼ <input id="joinDate" type="text" placeholder="yyyy-mm-dd"></label>
      <label>í‡´ì‚¬ì¼ <input id="leaveDate" type="text" placeholder="yyyy-mm-dd"></label>
      <button id="calcBtn" class="btn">ê³„ì‚°</button>
      <span class="subtle">ë‚ ì§œëŠ” 8ìë¦¬(ì˜ˆ: 20240712)ë§Œ ì…ë ¥í•´ë„ ë©ë‹ˆë‹¤.</span>
    </div>

    <div class="tables">
      <!-- íšŒê³„ì—°ë„ ê¸°ì¤€ -->
      <div class="table-wrap">
        <table id="tblFiscal">
          <tr><th class="sec-title" colspan="5">ì—°ì°¨íœ´ê°€ ê³„ì‚°ê¸° (íšŒê³„ì—°ë„ ê¸°ì¤€)</th></tr>
          <tr>
            <th style="width:20%">êµ¬ë¶„</th>
            <th class="yellow">ë°œìƒì¼ì</th>
            <th class="yellow right">ë°œìƒì¼ìˆ˜</th>
            <th>ê¸° ì‚¬ìš©ì¼ìˆ˜</th>
            <th>ë³´ìƒì¼ìˆ˜</th>
          </tr>
          <tbody id="fiscalBody"></tbody>
          <tr>
            <th>í•©ê³„</th>
            <td class="yellow"></td>
            <td class="yellow right mono highlight-cell" id="fiscalSum">0</td>
            <td class="right mono highlight-cell" id="fiscalUsedSum">0</td>
            <td class="right mono highlight-cell" id="fiscalCompSum">0</td>
          </tr>
        </table>
      </div>

      <!-- ì…ì‚¬ì¼ ê¸°ì¤€ -->
      <div class="table-wrap">
        <table id="tblAnniv">
          <tr><th class="sec-title" colspan="5">ì—°ì°¨íœ´ê°€ ê³„ì‚°ê¸° (ì…ì‚¬ì¼ ê¸°ì¤€)</th></tr>
          <tr>
            <th style="width:20%">ê·¼ì†ë…„ìˆ˜</th>
            <th class="yellow">ë°œìƒì¼ì</th>
            <th class="yellow right">ë°œìƒì¼ìˆ˜</th>
            <th>ê¸° ì‚¬ìš©ì¼ìˆ˜</th>
            <th>ë³´ìƒì¼ìˆ˜</th>
          </tr>
          <tbody id="annivBody"></tbody>
          <tr>
            <th>í•©ê³„</th>
            <td class="yellow"></td>
            <td class="yellow right mono highlight-cell" id="annivSum">0</td>
            <td class="right mono highlight-cell" id="annivUsedSum">0</td>
            <td class="right mono highlight-cell" id="annivCompSum">0</td>
          </tr>
        </table>
      </div>
    </div>

    <div class="note">
      * 2017ë…„ 5ì›” 29ì¼ ì´ì „ ì…ì‚¬ìì˜ ê²½ìš°ì—ë„ ìë™ ê³„ì‚°ë©ë‹ˆë‹¤.<br>
      * íšŒê³„ì—°ë„ ê¸°ì¤€ë³´ë‹¤ ì…ì‚¬ì¼ ê¸°ì¤€ìœ¼ë¡œ ë³´ìƒì¼ìˆ˜ê°€ ë§ìœ¼ë©´ ì…ì‚¬ì¼ ê¸°ì¤€ìœ¼ë¡œ ì •ì‚°í•˜ì—¬ì•¼ í•©ë‹ˆë‹¤.<br>
      * ìƒê¸° ê³„ì‚° ë°©ì‹ì€ ì—…ë¬´ì˜ í¸ì˜ë¥¼ ë•ê¸° ìœ„í•œ ê²ƒìœ¼ë¡œ ë²•ì  íš¨ë ¥ì´ ì—†ìœ¼ë©° êµ¬ì²´ì ì¸ ë‚´ìš©ì€ ê³µì¸ë…¸ë¬´ì‚¬ì— ë¬¸ì˜ ë°”ëë‹ˆë‹¤.
    </div>
  </div>
</div>

<!-- ê³µí†µ í‘¸í„° -->
<footer class="site-footer">
  â“’ 2025 <span class="brand-inline">LISANG Lab</span>. all rights reserved.<br />
  ë³¸ ì‚¬ì´íŠ¸ì˜ ì½˜í…ì¸ (ë¬¸ì„œ, ì½”ë“œ, ë””ìì¸, ê³„ì‚° ë¡œì§ ë“±)ëŠ” ë¹„ì˜ë¦¬ì  ëª©ì ì˜ ê³µìœ Â·ì¸ìš©Â·ë°°í¬ëŠ” ì¶œì²˜(â€˜LISANG Labâ€™)ë¥¼ ëª…ì‹œí•˜ë©´ ììœ ë¡­ê²Œ í—ˆìš©í•©ë‹ˆë‹¤.<br />
  ë‹¨, ë™ì˜ì—†ëŠ” ìƒì—…ì  ì´ìš©(ì˜ë¦¬ ëª©ì ì˜ ë³µì œÂ·ë°°í¬Â·íŒë§¤Â·ì¬ê°€ê³µ ë“±)ì€ ê¸ˆì§€ë©ë‹ˆë‹¤.<br />
  ë³¸ ê³„ì‚°ê¸°ëŠ” ì°¸ê³ ìš©ì´ë©°, ê³„ì‚° ê²°ê³¼ì— ë”°ë¥¸ ë²•ì  ì±…ì„ì€ ì§€ì§€ ì•ŠìŠµë‹ˆë‹¤.<br />
  ì´ìš© ì¤‘ ì˜¤ë¥˜ ì œë³´ë‚˜ ê°œì„  ì œì•ˆì€ <a href="mailto:lisang.hr.lab@gmail.com">lisang.hr.lab@gmail.com</a>ìœ¼ë¡œ ì—°ë½í•´ ì£¼ì„¸ìš”.
</footer>

<script>
/* ë„¤ë¹„ê²Œì´ì…˜(ì…€ë ‰íŠ¸ëŠ” ìœ ì§€) */
document.getElementById('navSelect').addEventListener('change', e=>{
  if(e.target.value) location.href = e.target.value;
});

/* í…Œë§ˆ */
(function(){
  const saved = localStorage.getItem('theme');
  if(saved) document.documentElement.setAttribute('data-theme', saved);
  updateThemeBtn();
})();
function updateThemeBtn(){
  const dark=document.documentElement.getAttribute('data-theme')==='dark';
  document.getElementById('themeBtn').textContent=dark?'â˜€ï¸ ë¼ì´íŠ¸ ëª¨ë“œ':'ğŸŒ™ ë‹¤í¬ ëª¨ë“œ';
}
document.getElementById('themeBtn').addEventListener('click',()=>{
  const cur=document.documentElement.getAttribute('data-theme')||'light';
  const next=cur==='light'?'dark':'light';
  document.documentElement.setAttribute('data-theme',next);
  localStorage.setItem('theme',next);
  updateThemeBtn();
});

/* ë‚ ì§œ ìœ í‹¸ */
function toYmd(val){
  const v=(val||'').replace(/\D/g,''); if(v.length!==8) return null;
  const y=v.slice(0,4),m=v.slice(4,6),d=v.slice(6,8);
  if(+m<1||+m>12||+d<1||+d>31)return null;
  return `${y}-${m}-${d}`;
}
['joinDate','leaveDate'].forEach(id=>{
  const el=document.getElementById(id);
  el.addEventListener('input',()=>{const fm=toYmd(el.value);if(fm)el.value=fm;});
});
const dt=s=>new Date(s);
const fmtDate=d=>d.toISOString().slice(0,10);
function addMonths(date,n){const d=new Date(date),day=d.getDate();d.setMonth(d.getMonth()+n);if(d.getDate()<day)d.setDate(0);return d;}
function addYears(date,n){const d=new Date(date);d.setFullYear(d.getFullYear()+n);return d;}
function daysInclusive(a,b){const A=(a instanceof Date)?a:new Date(a);const B=(b instanceof Date)?b:new Date(b);return Math.max(0,Math.floor((B-A)/86400000)+1);}

/* ë¡œì§(ê¸°ì¡´) */
function monthlyAccruals(join,leave){
  const first=addYears(join,1);
  const end=(leave && leave<first)?leave:first;
  const arr=[]; let cur=addMonths(join,1);
  while(cur<=end){arr.push(new Date(cur));cur=addMonths(cur,1);}
  return arr.filter(d=>d<first && (!leave || d<=leave));
}
function regularDaysByYearN(n){return Math.min(25,15+Math.floor((n-1)/2));}
function fiscalDaysByDisplayYear(y){if(y<=4)return 15;const add=Math.floor((y-3)/2);return Math.min(25,15+add);}
const showIfAfterLeave = (accrualDate, leave) => (!leave || leave >= accrualDate);

function clearTbody(tb){while(tb.firstChild)tb.removeChild(tb.firstChild);}
function tr(cs){const r=document.createElement('tr');cs.forEach(c=>r.appendChild(c));return r;}
function th(t){const e=document.createElement('th');e.textContent=t;return e;}
function td(t,c=''){const e=document.createElement('td');e.textContent=t;if(c)e.className=c;return e;}

function usedCompCells(baseDays,typeTag,isLegacy){
  const usedTd=document.createElement('td');
  const inp=document.createElement('input');
  inp.type='number'; inp.min='0'; inp.step='0.1'; inp.value='0'; inp.className='num-input mono';
  usedTd.appendChild(inp);
  const compTd=document.createElement('td'); compTd.className='right mono';
  function update(){
    let comp=0;
    if(isLegacy && (typeTag==='fiscal-y1'||typeTag==='fiscal-y2carry'||typeTag==='anniv-under1')) comp=0;
    else {const used=parseFloat(inp.value)||0; comp=Math.max(0,baseDays-used);}
    compTd.textContent=(Math.round(comp*10)/10).toString(); recalcSums();
  }
  inp.addEventListener('input',update); update(); return [usedTd,compTd];
}

function recalcSums(){
  [['fiscalBody','fiscalSum','fiscalUsedSum','fiscalCompSum'],
   ['annivBody','annivSum','annivUsedSum','annivCompSum']].forEach(([tb,sum,used,comp])=>{
    const tbody=document.getElementById(tb);
    const base=[...tbody.querySelectorAll('td.yellow.right')].reduce((a,e)=>a+(parseFloat(e.textContent)||0),0);
    const usedSum=[...tbody.querySelectorAll('input.num-input')].reduce((a,e)=>a+(parseFloat(e.value)||0),0);
    const compSum=[...tbody.querySelectorAll('tr')].reduce((a,row)=>{
      const last=row.querySelector('td:last-child'); return a+(last?(parseFloat(last.textContent)||0):0);
    },0);
    document.getElementById(sum).textContent=(Math.round(base*10)/10).toString();
    document.getElementById(used).textContent=(Math.round(usedSum*10)/10).toString();
    document.getElementById(comp).textContent=(Math.round(compSum*10)/10).toString();
  });
}

/* ë©”ì¸ ê³„ì‚° (ê¸°ì¡´) */
function calc(){
  const jStr=document.getElementById('joinDate').value;
  const lStr=document.getElementById('leaveDate').value;
  if(!jStr)return;
  const join=dt(jStr),leave=lStr?dt(lStr):null;
  const isLegacy=join<new Date('2017-05-29');

  /* ì…ì‚¬ì¼ ê¸°ì¤€ */
  const aBody=document.getElementById('annivBody');clearTbody(aBody);let aSum=0;
  const mDates=monthlyAccruals(join,leave);
  if(mDates.length){
    const label=`ë§¤ì›” ${String(join.getDate()).padStart(2,'0')}ì¼`;
    const base=mDates.length*1.0;const[u,c]=usedCompCells(base,'anniv-under1',isLegacy);
    aBody.appendChild(tr([th('1ë…„ ë¯¸ë§Œ'),td(label,'yellow'),td(base.toFixed(1),'yellow right mono'),u,c]));aSum+=base;
  }
  let n=1;let gen=addYears(join,1);
  while(!leave||gen<=leave){
    const days=regularDaysByYearN(n);const base=+days.toFixed(1);
    const[u,c]=usedCompCells(base,'anniv-regular',isLegacy);
    aBody.appendChild(tr([th(`${n}ë…„ê·¼ì†`),td(fmtDate(gen),'yellow'),td(base.toFixed(1),'yellow right mono'),u,c]));
    aSum+=base;n++;gen=addYears(gen,1);if(n>50)break;
  }
  document.getElementById('annivSum').textContent=(Math.round(aSum*10)/10).toString();

  /* íšŒê³„ì—°ë„ ê¸°ì¤€ */
  const fBody=document.getElementById('fiscalBody');clearTbody(fBody);let fSum=0;
  const firstAnniv=addYears(join,1);
  const monthsAll=monthlyAccruals(join,leave);
  const monthsY1=monthsAll.filter(d=>d.getFullYear()===join.getFullYear());
  const monthsCarry=monthsAll.filter(d=>d.getFullYear()!==join.getFullYear());
  const monthLabel=`ë§¤ì›” ${String(join.getDate()).padStart(2,'0')}ì¼`;

  {const base=monthsY1.length*1.0;const[u,c]=usedCompCells(base,'fiscal-y1',isLegacy);
   fBody.appendChild(tr([th('1ë…„ì°¨'),td(monthLabel,'yellow'),td(base.toFixed(1),'yellow right mono'),u,c]));fSum+=base;}

  {const base=monthsCarry.length*1.0;const[u,c]=usedCompCells(base,'fiscal-y2carry',isLegacy);
   fBody.appendChild(tr([th('2ë…„ì°¨ @'),td(monthLabel,'yellow'),td(base.toFixed(1),'yellow right mono'),u,c]));fSum+=base;}

  { // 2ë…„ì°¨(ë¹„ë¡€ì—°ì°¨)
    const endPrevYear=new Date(join.getFullYear(),11,31);
    let prorate=0;
    if(endPrevYear>=join){
      const svcPrev=daysInclusive(join,endPrevYear);
      const raw=(svcPrev/365)*15;
      prorate=Math.ceil(raw*10)/10;
    }
    const base=+prorate.toFixed(1);
    const[u,c]=usedCompCells(base,'fiscal-y2prorate',isLegacy);
    const accrual = new Date(`${firstAnniv.getFullYear()}-01-01`);
    if(showIfAfterLeave(accrual, leave)){ // í‡´ì‚¬ì¼ ì´í›„ ë°œìƒì´ë©´ ìˆ¨ê¹€
      fBody.appendChild(tr([th('2ë…„ì°¨(ë¹„ë¡€ì—°ì°¨)'),td(`${firstAnniv.getFullYear()}-01-01`,'yellow'),
        td(base.toFixed(1),'yellow right mono'),u,c])); fSum+=base;
    }
  }

  { // 3ë…„ì°¨ë¶€í„°: 3Â·4ë…„ì°¨ 15, 5ë…„ì°¨ë¶€í„° ê°€ì‚°
    let fyYear = firstAnniv.getFullYear()+1; // 3ë…„ì°¨ í•´
    let fyN = 2;                             // í‘œì‹œì—°ì°¨ = fyN+1
    let fyDate = addYears(firstAnniv,1);     // 3ë…„ì°¨ ë°œìƒ ê¸°ì¤€ì¼(ë§Œ2ë…„ ë„ë‹¬ì¼)
    while(!leave || fyDate<=leave){
      const displayYear = fyN + 1; // 3,4,5,...
      const days = fiscalDaysByDisplayYear(displayYear);
      const base = +days.toFixed(1);
      const[u,c]=usedCompCells(base,'fiscal-regular',isLegacy);
      const accrual = new Date(`${fyYear}-01-01`);
      if(showIfAfterLeave(accrual, leave)){
        fBody.appendChild(tr([th(`${displayYear}ë…„ì°¨`),td(`${fyYear}-01-01`,'yellow'),
          td(base.toFixed(1),'yellow right mono'),u,c])); fSum+=base;
      }
      fyN++; fyYear++; fyDate=addYears(fyDate,1); if(fyN>50)break;
    }
  }
  document.getElementById('fiscalSum').textContent=(Math.round(fSum*10)/10).toString();

  recalcSums();
}

document.getElementById('calcBtn').addEventListener('click', calc);
</script>
</body>
</html>
