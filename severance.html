<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>평균임금 및 퇴직금 산정내역</title>
<meta name="description" content="평균임금 및 퇴직금 산정내역 - 3개월(최대 4개월 구간) 임금, 평균임금, 퇴직금 자동 계산" />
<style>
  :root{
    --bg:#0b0f14; --paper:#111823; --line:#2a3649; --muted:#8aa0b2; --text:#eaf2f9;
    --head:#192233; --accent:#4da3ff; --good:#19c37d; --warn:#ff6b6b;
  }
  *{box-sizing:border-box}
  html,body{margin:0;padding:0;background:var(--bg);color:var(--text);
    font-family:system-ui,-apple-system,Segoe UI,Roboto,Apple SD Gothic Neo,Malgun Gothic,Helvetica,Arial,sans-serif}
  main{max-width:1060px;margin:18px auto 60px;padding:0 14px}
  .sheet{background:var(--paper);border:1px solid var(--line);border-radius:14px;overflow:hidden}
  .sheet h1{margin:0;background:var(--head);text-align:center;padding:16px 10px;font-size:20px;letter-spacing:1px}
  table{width:100%;border-collapse:collapse}
  th,td{border:1px solid var(--line);padding:8px 10px;vertical-align:middle}
  th{background:#142034}
  .sec-title{background:#142034;font-weight:800}
  .small{font-size:12px;color:var(--muted)}
  .mono{font-variant-numeric:tabular-nums}
  input[type="text"],input[type="number"],input[type="date"]{
    width:100%;padding:8px 10px;border:1px solid #293443;border-radius:8px;background:#0f1620;color:var(--text)}
  input[type="number"]{text-align:right}
  .btn{display:inline-block;margin:10px 0;padding:10px 14px;border-radius:10px;border:1px solid #2c3b55;background:#0f1620;color:var(--text);cursor:pointer}
  .right{text-align:right}
  .muted{color:var(--muted)}
  .note{padding:10px 12px;font-size:12px;color:var(--muted);line-height:1.6}
  .bar{display:flex;gap:8px;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid var(--line);background:#0f1620}
  select{padding:8px 10px;border-radius:8px;border:1px solid #2c3b55;background:#0f1620;color:var(--text)}
  .warn{color:var(--warn);font-weight:700}
</style>
</head>
<body>
<main>
  <div class="sheet">
    <div class="bar">
      <strong>계산기 이동</strong>
      <div>
        <select id="calcSelect">
          <option value="">— 선택 —</option>
          <option value="./severance.html" selected>퇴직금 계산기</option>
          <option value="./annual.html">연차수당 계산기</option>
          <option value="./hours52.html">주52시간 근무시간 계산기</option>
          <option value="./">메인</option>
        </select>
      </div>
    </div>

    <h1>평균임금 및 퇴직금 산정내역</h1>

    <!-- 1. 인적사항(간소화) -->
    <table>
      <tr><th class="sec-title" colspan="8">1. 인적사항</th></tr>
      <tr>
        <th>입사연월일</th>
        <td><input id="joinDate" type="date" /></td>
        <th>퇴사연월일</th>
        <td><input id="leaveDate" type="date" /></td>
        <th>근속 연수</th>
        <td>
          <span class="mono" id="svcY">0</span>년
          <span class="mono" id="svcM">0</span>개월
          <span class="mono" id="svcD">0</span>일
        </td>
        <th>총 근로일수(일)</th>
        <td class="right mono" id="svcDays">0</td>
      </tr>
    </table>

    <!-- 2. 평균임금의 계산 -->
    <table>
      <tr><th class="sec-title" colspan="8">2. 평균임금의 계산</th></tr>
      <tr><th colspan="8" class="small">※ 평균임금 = 최근 3개월 총임금 ÷ (최근 3개월 총일수 − 제외일수). 3개월이 4개월 구간으로 나뉠 수 있음.</th></tr>

      <!-- (1) 3개월간 월 급여(최대 4구간) -->
      <tr><th colspan="8">(1) 최근 3개월 기간(최대 4구간)</th></tr>
      <tr>
        <th style="width:16%">구간</th>
        <th>시작일</th>
        <th>종료일</th>
        <th>일수(자동)</th>
        <th colspan="2">임금(급여/수당 등)</th>
        <th colspan="2">비고</th>
      </tr>
      <!-- 4 rows -->
      <tr>
        <td>①</td>
        <td><input id="p1s" type="date" /></td>
        <td><input id="p1e" type="date" /></td>
        <td class="right mono" id="p1d">0</td>
        <td colspan="2"><input id="p1w" type="number" value="0" /></td>
        <td colspan="2" class="small">예: 7/10~7/31</td>
      </tr>
      <tr>
        <td>②</td>
        <td><input id="p2s" type="date" /></td>
        <td><input id="p2e" type="date" /></td>
        <td class="right mono" id="p2d">0</td>
        <td colspan="2"><input id="p2w" type="number" value="0" /></td>
        <td colspan="2" class="small">예: 8/1~8/31</td>
      </tr>
      <tr>
        <td>③</td>
        <td><input id="p3s" type="date" /></td>
        <td><input id="p3e" type="date" /></td>
        <td class="right mono" id="p3d">0</td>
        <td colspan="2"><input id="p3w" type="number" value="0" /></td>
        <td colspan="2" class="small">예: 9/1~9/30</td>
      </tr>
      <tr>
        <td>④</td>
        <td><input id="p4s" type="date" /></td>
        <td><input id="p4e" type="date" /></td>
        <td class="right mono" id="p4d">0</td>
        <td colspan="2"><input id="p4w" type="number" value="0" /></td>
        <td colspan="2" class="small">예: 10/1~10/10</td>
      </tr>
      <tr>
        <th>제외일수 합계</th>
        <td colspan="2"><input id="excl" type="number" value="0" /></td>
        <th>총일수(달력일)</th>
        <td class="right mono" id="totDays">0</td>
        <th>분모(총일수−제외)</th>
        <td class="right mono" id="effDays" colspan="2">0</td>
      </tr>
      <tr>
        <th>최근3개월 임금 합계</th>
        <td class="right mono" id="wageSum" colspan="2">0</td>
        <th>평균임금(1일)</th>
        <td class="right mono" id="avgDaily">0</td>
        <th>평균임금(30일분)</th>
        <td class="right mono" id="avg30" colspan="2">0</td>
      </tr>

      <!-- (2) 연차/상여 3개월분(선택) -->
      <tr><th colspan="8">(2) 연차수당·상여금 (최근 3개월 귀속분만 입력, 선택)</th></tr>
      <tr>
        <th>연차수당 3개월분</th>
        <td colspan="2"><input id="ann3m" type="number" value="0" /></td>
        <th>상여금 3개월분</th>
        <td colspan="2"><input id="bon3m" type="number" value="0" /></td>
        <th>총 임금(가산 후)</th>
        <td class="right mono" id="allSum">0</td>
      </tr>
    </table>

    <!-- 3. 퇴직금 -->
    <table>
      <tr><th class="sec-title" colspan="8">3. 퇴직금</th></tr>
      <tr>
        <th>평균임금(1일)</th>
        <td class="right mono" id="avgDaily2">0</td>
        <th>퇴직금(법정)</th>
        <td class="right mono" id="sevPay">0</td>
        <th>퇴직보험금</th>
        <td class="right"><input id="insPay" type="number" value="0" /></td>
        <th>중간정산/기지급</th>
        <td class="right"><input id="paidPay" type="number" value="0" /></td>
      </tr>
      <tr>
        <th>차인지급액</th>
        <td class="right mono" id="diffPay" colspan="7">0</td>
      </tr>
    </table>

    <div style="padding:12px">
      <button class="btn" id="btnAuto">① 퇴사일 기준 4구간 자동 생성</button>
      <button class="btn" id="btnCalc">② 계산하기</button>
      <span class="small muted">※ 자동 생성 후, 각 구간의 임금만 입력하면 됩니다.</span>
      <div class="note">
        • 3개월은 퇴사일을 기준으로 **달력상 3개월**이며, 시작일~퇴사일까지가 4개 달로 나뉠 수 있습니다.<br/>
        • 제외일수: 무급휴직·무급병가·결근 등 평균임금 분모에서 제외해야 하는 일수 합계.<br/>
        • 퇴직금(법정) = 평균임금×30 × (재직일수÷365) (입·퇴사일 포함, 단순 비례).<br/>
        • 근속 1년 미만은 법정 퇴직급여 의무 미적용(취업규칙/단협 유리규정은 별도).
      </div>
    </div>
  </div>
</main>

<script>
  const fmt = n => Number.isFinite(n) ? n.toLocaleString('ko-KR') : '0';

  // 네비
  document.getElementById('calcSelect').addEventListener('change', e=>{
    if(e.target.value) location.href = e.target.value;
  });

  // 날짜 유틸(양끝 포함 일수)
  function daysInclusive(s, e){
    const S = new Date(s), E = new Date(e);
    return Math.max(0, Math.floor((E - S)/(1000*60*60*24)) + 1);
  }
  function daysInMonth(y, m){ return new Date(y, m+1, 0).getDate(); } // m:0~11

  // ① 퇴사일 기준 4구간 자동 생성
  document.getElementById('btnAuto').addEventListener('click', ()=>{
    const ld = document.getElementById('leaveDate').value;
    if(!ld){ alert('퇴사연월일을 먼저 입력하세요.'); return; }

    const L = new Date(ld);
    const d = L.getDate();
    // 시작일: 퇴사일로부터 '달 단위로 3개월 전, 같은 일자' (JS가 말일 처리 자동 보정)
    const S = new Date(L); S.setMonth(S.getMonth()-3);

    // 구간1: S ~ 그 달 말일
    const y1 = S.getFullYear(), m1 = S.getMonth();
    const p1s = new Date(y1, m1, S.getDate());
    const p1e = new Date(y1, m1, daysInMonth(y1, m1));

    // 중간 가득달(필요시 0~2개)
    const midMonths = [];
    let cur = new Date(y1, m1+1, 1);
    while(cur.getFullYear() < L.getFullYear() || (cur.getFullYear()===L.getFullYear() && cur.getMonth() < L.getMonth())){
      const y = cur.getFullYear(), m = cur.getMonth();
      midMonths.push([new Date(y,m,1), new Date(y,m,daysInMonth(y,m))]);
      cur = new Date(y, m+1, 1);
    }

    // 구간4(마지막): 퇴사월 1일 ~ 퇴사일
    const p4s = new Date(L.getFullYear(), L.getMonth(), 1);
    const p4e = L;

    // midMonths를 ②③로 배치(없으면 비워두기)
    const rows = [
      [p1s, p1e],                        // ①
      midMonths[0] || [null,null],       // ②
      midMonths[1] || [null,null],       // ③
      [p4s, p4e]                         // ④
    ];

    const ids = [['p1s','p1e','p1d'],['p2s','p2e','p2d'],['p3s','p3e','p3d'],['p4s','p4e','p4d']];
    rows.forEach((r,i)=>{
      const [s,e]=r;
      if(s && e){
        document.getElementById(ids[i][0]).value = s.toISOString().slice(0,10);
        document.getElementById(ids[i][1]).value = e.toISOString().slice(0,10);
        document.getElementById(ids[i][2]).textContent = fmt(daysInclusive(s,e));
      }else{
        document.getElementById(ids[i][0]).value = "";
        document.getElementById(ids[i][1]).value = "";
        document.getElementById(ids[i][2]).textContent = "0";
      }
    });

    // 총일수/분모도 초기 반영
    updateTotals();
  });

  function updatePeriodDays(){
    const trip = [['p1s','p1e','p1d'],['p2s','p2e','p2d'],['p3s','p3e','p3d'],['p4s','p4e','p4d']];
    trip.forEach(([sId,eId,dId])=>{
      const s = document.getElementById(sId).value;
      const e = document.getElementById(eId).value;
      const days = (s && e) ? daysInclusive(s,e) : 0;
      document.getElementById(dId).textContent = fmt(days);
    });
  }

  function updateTotals(){
    updatePeriodDays();
    const days = ['p1d','p2d','p3d','p4d'].map(id=>Number((document.getElementById(id).textContent||'0').replace(/,/g,'')));
    const totDays = days.reduce((a,b)=>a+b,0);
    const excl = Number(document.getElementById('excl').value||0);
    const effDays = Math.max(totDays - excl, 0);

    const wages = ['p1w','p2w','p3w','p4w'].map(id=>Number(document.getElementById(id).value||0));
    const wageSum = wages.reduce((a,b)=>a+b,0);

    const ann3m = Number(document.getElementById('ann3m').value||0);
    const bon3m = Number(document.getElementById('bon3m').value||0);
    const allSum = wageSum + ann3m + bon3m;

    const avgDaily = effDays>0 ? (allSum / effDays) : 0;
    const avg30 = avgDaily * 30;

    document.getElementById('totDays').textContent = fmt(totDays);
    document.getElementById('effDays').textContent = fmt(effDays);
    document.getElementById('wageSum').textContent = fmt(wageSum);
    document.getElementById('allSum').textContent  = fmt(allSum);
    document.getElementById('avgDaily').textContent= fmt(Math.round(avgDaily));
    document.getElementById('avg30').textContent   = fmt(Math.round(avg30));
    document.getElementById('avgDaily2').textContent=fmt(Math.round(avgDaily));
  }

  // 입력 변경 시 합계 갱신
  ['p1s','p1e','p2s','p2e','p3s','p3e','p4s','p4e','p1w','p2w','p3w','p4w','excl','ann3m','bon3m']
    .forEach(id=>document.getElementById(id).addEventListener('input', updateTotals));

  // ② 계산: 근속·퇴직금·차인지급
  document.getElementById('btnCalc').addEventListener('click', ()=>{
    const jd = document.getElementById('joinDate').value;
    const ld = document.getElementById('leaveDate').value;
    if(!jd || !ld){ alert('입사/퇴사 연월일을 입력하세요.'); return; }

    const S = new Date(jd), E = new Date(ld);
    const svcDays = Math.floor((E - S)/(1000*60*60*24)) + 1;
    const y = Math.floor(svcDays/365), rem = svcDays%365, m = Math.floor(rem/30), d = rem%30;
    document.getElementById('svcDays').textContent = fmt(Math.max(0, svcDays));
    document.getElementById('svcY').textContent = y; document.getElementById('svcM').textContent = m; document.getElementById('svcD').textContent = d;

    // 평균임금 1일치
    updateTotals();
    const avgDaily = Number((document.getElementById('avgDaily2').textContent||'0').replace(/,/g,'')) || 0;

    // 법정 퇴직금 (1년 미만 0원)
    const eligible = svcDays >= 365;
    const sev = eligible ? Math.floor(avgDaily * 30 * (svcDays/365)) : 0;
    document.getElementById('sevPay').textContent = fmt(sev);

    const ins = Number(document.getElementById('insPay').value||0);
    const paid = Number(document.getElementById('paidPay').value||0);
    const diff = Math.max(sev - (ins + paid), 0);
    document.getElementById('diffPay').textContent = fmt(diff);
  });
</script>
</body>
</html>
